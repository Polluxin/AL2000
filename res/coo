@startuml
AL2000 "0..1" --> "1" Compte : interagit
AL2000 "1" --> "1" Panier : possède
AL2000 "1" --> "1" HistoLoc : consulte
AL2000 "1" --> "1" Catalogue : consulte
AL2000 "1" --> "1" Signalement: interagit
AL2000 "1" -r-> "1" Distributeur : opère
AL2000 "1" -r-> "0..1" Technicien : authentifie

Technicien "1" --> "1" Maintenance : opère

Machine "1" --> "1" Statistiques : met à jour
Machine "1" -r-> "1" Inventaire : met à jour
Machine .u.|> Distributeur
Machine .u.|> Maintenance


Compte "0..*" --> "1" Client : associe

Panier "1" --> "0..*" Location : contient

HistoLoc "1" <-- "1" Police : analyse

Catalogue "*" --> "1" FiltreTri : utilise

Client "1" --> "1" Carte : possède
Client "*" -r-> "*" Genre : interdit
Client <|-- Abonné
Client <|-- Anonyme

Carte <|-- CB
Carte <|-- CarteAbo

Location "0..*" --> "1" Support : contient
Location "0..*" --o "1" Client
Location .. Etat

Support "1..*" --> "1" Film : possède
Support <|-- "QR Code"
Support <|-- "BluRay"

class AL2000 {
- initialisation()
+ louerFilms()
+ rendreFilms()
+ donnerCatalogue(f:Filtre) : Liste<FilmFormat>
+ inscription(f:Formulaire)
+ connexion(mdp:String)
+ connexionTechnicien()
+ deconnexion()
+ ajouterPanier(s:Support)
+ changerSupportPanier(l:Location)
+ consulterPanier() : Liste<Location>
+ validerPanier()
+ voirHistoMachine() : Liste<Location>
+ voirHistoClient() : Liste<Location>
+ voirStatistiques() : Statistiques
+ ouvrirMachine()
+ fermerMachine()
+ recharger(m:float)
+ retirerSolde(cb: CB)
+ signalerProblème(f:FormulaireSignalement)
+ réglerInterdits(li: Liste<Genre>)
}
note right of AL2000::validerPanier
  - si Anonyme alors lireCB().verifier_fonds(montant)
    sinon compte.verifier_fonds(montant)
  - h.ajouterLocations(p.valider())
end note


class Compte {
+ inscrire(f: FormulaireInscription)
+ connexion(c: CarteAbo, mdp: String)
+ deconnexion()
+ vérifier_fonds(m: float) : bool
+ rechargerSolde(montant: float, cb: CB)
+ retirerSolde(cb: CB)
+ réglerInterdits(L: Liste<Genre>)
+ AnonymeSetCB(cb: CB)

}
note right of Compte::connexion
  Interrogation de la BD
end note

abstract class Client {
+ payer(montant: float)
+ recharger(montant: float)
+ réglerInterdits(L: Liste<Genre>)
}

class Abonné {
+ nom: String
+ prenom : String
+ adresseMail : String
+ adressePostale : String
}

class Panier {
+ ajouter(s: Support, c: Client)
+ supprimer(l:location)
+ modifier(l:Location)
+ vérifier() : bool
+ consulter() : Liste<Location>
+ valider() : Liste<Location>
}

class Catalogue {
liste_films : List<Films>
inv : Inventaire
+ donnerFilms(a:Abonné, f:FiltreTri) : Liste<Films,bool>
- récupérerPréférences(a:Abonné) : Préférences
- récupérerFilmsBD() : Liste<Films>
}

class Signalement {
+ envoyer(FormulaireSignalement)
}
note bottom of Signalement : Un signalement envoyé à CyberVidéo.

class Machine {
+ inv : Inventaire
+ stat : Statistiques
}

class HistoLoc {
+ voirHistorique() : Liste<Location>
+ voirHistoriqueClient(a:Abonné) : Liste<Location>
+ aLocationEnCours(a:Abonné) : bool
+ ajouterLocations(l:Liste<Location>, a:Abonne)
+ rendreBluRay(b:BluRay)
+ rendreBluRay(lb:Liste<BluRay>)
+ calculerMontant(b:BlueRay) : float
}

class Technicien {
id : int
histo : HistoLoc
+ voirHistorique() : Liste<Location>
+ ouvrirMachine()
+ fermerMachine()
+ voirStatistiques() : Statistiques
+ donnerInventaire() : Inventaire
}

interface Distributeur {
+ lireCB() : CB
+ lireCarteAbo() : CarteAbo
+ lireCTechnicien() : Technicien
+ livrerFilms(liste_films:Liste<FilmFormat>) : bool
+ avalerBluRays()
}

interface Maintenance {
+ ouvrir()
+ fermer()
+ voirStatistiques() : Statistiques
+ donnerInventaire() : Inventaire
}


class Inventaire {
- liste_BluRays : Liste<BluRay>
+ ajouterBluRays(lb:Liste<BluRay>)
+ supprimerBluRay(b:BluRay)
}

class Statistiques {
nbLocations : int
nbOuvertures : int
}

class Location {
- dateLocatin: Date
- etatLocation: Etat
+ {Static} fondsNecessaire(l: location, promo: bool)
+ {Static} fondsNecessaire(L: Liste<location>, promo: bool)
}

abstract class Carte {
- id: int
+ payer(montant: float)
+ recharger(montant: float)
+ vérifier_fonds(m: float): bool
}

class CB {
- informationBanquaires: String
}

class CarteAbo {
- solde: float
}

abstract class Support {
id: int
}

class "QR Code" {

}

class BluRay {

}

class Film {
titre: String
date: String
réalisateur: String
durée: String
genre: Genre
}

class Police {
- t:Timer
##TODO
}

note right of Police : Vérifie périodiquement s'il y a des locations\nnon rendues depuis plus de 5 jours.

enum Etat {
 ENCOURS
 TERMINEE
}

enum Genre {
 WESTERN
 ACTION
 FANTAISIE
 ANIME
 HORREUR
 SF
 SUSPENSE
 ROMANCE
 COMEDIE
}

class FiltreTri {
+ t:Tri
+ valeur:String
}

@enduml